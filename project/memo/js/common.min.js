"use strict";function addMemoire(){$("#addMemoire").click(function(e){$("edit-page").css("display","block").animate({left:"0%"},300),$(e.currentTarget).is("#addMemoire")&&$("#memoireContent").prop("readonly",!1)}),$("#backMainPage").click(function(){var e=$("edit-page");e.animate({left:"100%"},300,function(){e.css("display","none"),$("#memoireContent").val("")})})}function editCtrl(){$("#editList").click(function(){$(this).css("display","none"),$("#cancelEdit").css("display","block"),$("#addMemoire").css("display","none"),$("#deleteCkdItem").css("display","block");var e=0==$(this).prop("disabled");if(e){var t=$("#memoireList li");t.children("div").animate({width:"48px"},200),t.children("p").animate({marginLeft:"36px"},200),t.addClass("disabled")}$("header h1").text("已选中0项")}),$("#cancelEdit").click(function(){$(this).css("display","none"),$("#editList").css("display","block"),$("#addMemoire").css("display","block"),$("#deleteCkdItem").css("display","none");var e=$("#memoireList li");e.children("div").animate({width:"0px"},200),e.children("p").animate({marginLeft:"0px"},200),$("header h1").text("备忘录"),$("#memoireList i.ckd").removeClass("ckd"),e.removeClass("disabled")})}function markListItem(){$("#memoireList").on("click","li > div",function(e){var o,t=$(this).children("i"),i=t.hasClass("ckd"),a=$(this).parent().index(),r=localStorage.getItem("memoireData"),n=JSON.parse(r);i?(t.removeClass("ckd"),n[a].deleteStatus=!1,o=n):(t.addClass("ckd"),n[a].deleteStatus=!0,o=n),o=JSON.stringify(o),localStorage.setItem("memoireData",o);var s=$("#memoireList i.ckd").length;$("header h1").text("已选中"+s+"项")})}function removeMarkListItem(){$("#deleteCkdItem").click(function(){for(var r,e=$("i.ckd").closest("li"),t=localStorage.getItem("memoireData"),i=JSON.parse(t),a=i.length,n=0,o=0;a>o;o++)i[o].deleteStatus&&n++;for(;n;){a=i.length;for(var s=0;a>s;s++)if(i[s].deleteStatus){i.splice(s,1),n--;break}}r=i,r=JSON.stringify(r),localStorage.setItem("memoireData",r),e.remove(),$("#cancelEdit").trigger("click"),setEditBtnStatus()})}function setSaveBtnStatus(){var e=$("#saveMemoire");$("#memoireContent").keyup(function(){var t=$(this).val(),i=""!==t,a=!/^\s+$/.test(t);i&&a?e.prop("disabled",!1):e.prop("disabled",!0)})}function saveMemoireData(){$("#saveMemoire").click(function(){function n(){var e=$("#memoireContent").val(),i=new Date,a=i.getFullYear(),r=i.getMonth()+1,n=i.getDate(),o=i.getHours(),s=i.getMinutes();r=1===String(r).length?"0"+r:r,n=1===String(n).length?"0"+n:n,o=1===String(o).length?"0"+o:o,s=1===String(s).length?"0"+s:s;var l=a+"-"+r+"-"+n+" "+o+":"+s;t={content:e,saveDate:l,deleteStatus:!1}}var e=$("#memoireContent").val();if(""!=e&&!/^\s+$/.test(e)){var t,i=null!==localStorage.getItem("memoireData");if(i){n();var a=localStorage.getItem("memoireData");if(a=JSON.parse(a),GLOBAL.editing){a.splice(GLOBAL.itemIndex,1,t);var r=$("#memoireList li").eq(GLOBAL.itemIndex);r.children("p:first").text(a[GLOBAL.itemIndex].content),r.children("p:last").text(a[GLOBAL.itemIndex].saveDate),a=JSON.stringify(a),localStorage.setItem("memoireData",a),$("#memoireContent").val(""),$("#backMainPage").trigger("click"),$("#saveMemoire").prop("disabled",!0),GLOBAL.editing=!1,GLOBAL.itemIndex=NaN}else a.push(t),a=JSON.stringify(a),localStorage.setItem("memoireData",a),locationDataCtrl()}else n(),t=JSON.stringify(t),localStorage.setItem("memoireData","["+t+"]"),locationDataCtrl()}})}function loadMemoireList(){var e=null!==localStorage.getItem("memoireData");if(e){var t=localStorage.getItem("memoireData");t=JSON.parse(t);var a=(t.length,$("#memoireList"));$.each(t,function(e,t){a.append("\n				<li>\n					<div>\n						<i>√</i>\n					</div>\n					<p>"+t.content+"</p>\n					<p>"+t.saveDate+"</p>\n				</li>\n			")}),setEditBtnStatus()}}function setEditBtnStatus(){var e=$("#memoireList")[0].childElementCount,t=$("#editList");0===e?(t.prop("disabled",!0),$("footer h2").text("无备忘录")):(t.prop("disabled",!1),$("footer h2").text(e+"个备忘录"))}function toMemoireEditPage(){$("#memoireList").on("click","li",function(e){var t=$(e.target);if(!t.is("i")&&!t.is("div")&&!$(this).hasClass("disabled")){var i=$(this).index(),a=localStorage.getItem("memoireData");a=JSON.parse(a),$("#memoireContent").val(a[i].content).prop("readonly",!0),GLOBAL.editing=!0,GLOBAL.itemIndex=i,$("#addMemoire").trigger("click")}})}function activeEditor(){$("#enableEdit").click(function(){var e=$("#memoireContent").val();""==e||/^\s+$/.test(e)||($("#memoireContent").prop("readonly",!1).focus(),$("#saveMemoire").prop("disabled",!1))})}function locationDataCtrl(){setTimeout(function(){var e=localStorage.getItem("memoireData");e=JSON.parse(e);var t=e.length;$("#memoireList").append("\n						<li>\n							<div>\n								<i>√</i>\n							</div>\n							<p>"+e[t-1].content+"</p>\n							<p>"+e[t-1].saveDate+"</p>\n						</li>\n					"),$("#memoireContent").val(""),$("#backMainPage").trigger("click"),$("#saveMemoire").prop("disabled",!0),setEditBtnStatus()},100)}var GLOBAL={editing:!1,itemIndex:NaN};$(function(){addMemoire(),editCtrl(),markListItem(),removeMarkListItem(),setSaveBtnStatus(),saveMemoireData(),loadMemoireList(),setEditBtnStatus(),toMemoireEditPage(),activeEditor()});